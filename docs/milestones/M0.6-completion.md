# M0.6 - Базовый HTTP Fetcher ✅

**Дата:** 19 октября 2025  
**Статус:** Завершено

## Что сделано

### 1. Типы для API (`types/api.ts`)

- ✅ Интерфейс `ApiErrorResponse` - структура ошибки от бэкенда
- ✅ Класс `ApiError` - типизированные ошибки с helper методами:
  - `isUnauthorized()` - проверка 401
  - `isForbidden()` - проверка 403
  - `isNotFound()` - проверка 404
  - `isRateLimited()` - проверка 429
  - `isValidationError()` - проверка ошибок валидации
- ✅ Интерфейс `HttpRequestOptions` - опции для HTTP запросов
- ✅ Интерфейс `PaginatedResponse<T>` - типизация пагинированных ответов

### 2. HTTP клиент (`lib/http.ts`)

- ✅ Константа `API_BASE_URL` - автоматическое получение из env
- ✅ Функция `createHeaders()` - создание заголовков с Authorization и Accept-Language
- ✅ Функция `handleResponse()` - обработка ответов и ошибок
- ✅ `httpGet<T>()` - GET запросы
- ✅ `httpPost<T>()` - POST запросы
- ✅ `httpPatch<T>()` - PATCH запросы
- ✅ `httpPut<T>()` - PUT запросы
- ✅ `httpDelete<T>()` - DELETE запросы
- ✅ `buildUrlWithParams()` - построение URL с query параметрами
- ✅ `buildLangPath()` - добавление языкового префикса

### 3. Документация

- ✅ `lib/README.md` - полная документация HTTP модуля с примерами
- ✅ `lib/http.examples.ts` - практические примеры использования для разработчиков

### 4. Обновления конфигурации

- ✅ `.env.example` - улучшены комментарии для `NEXT_PUBLIC_API_BASE_URL`
- ✅ Исправлен `.eslintrc.json` - совместимость с ESLint v8

## Возможности

### Базовые HTTP методы

```typescript
// GET
const data = await httpGet<Type>('/endpoint', options);

// POST
const result = await httpPost<Type>('/endpoint', body, options);

// PATCH
const updated = await httpPatch<Type>('/endpoint', body, options);

// PUT
const saved = await httpPut<Type>('/endpoint', body, options);

// DELETE
await httpDelete('/endpoint', options);
```

### Авторизация

```typescript
const user = await httpGet<User>('/users/me', {
  accessToken: session.accessToken,
});
```

### Мультиязычность

```typescript
const page = await httpGet<Page>('/en/pages/about', {
  language: 'en', // Устанавливает Accept-Language заголовок
});
```

### Обработка ошибок

```typescript
try {
  const data = await httpGet('/endpoint');
} catch (error) {
  if (error instanceof ApiError) {
    if (error.isNotFound()) {
      // 404
    } else if (error.isUnauthorized()) {
      // 401
    }
  }
}
```

### Вспомогательные утилиты

```typescript
// Query параметры
const url = buildUrlWithParams('/books', { page: 1, limit: 20 });
// '/books?page=1&limit=20'

// Языковой префикс
const path = buildLangPath('en', '/books/slug/overview');
// '/en/books/slug/overview'
```

## Проверки

- ✅ `yarn typecheck` - без ошибок
- ✅ `yarn lint` - без критических ошибок (только warnings о неиспользуемых переменных в заготовках)
- ✅ `yarn build` - успешная сборка

## Следующие шаги

Модуль готов к использованию в:

- M1 - авторизация (login/register)
- M2 - интеграция с React Query
- M3 - запросы в админке
- M5 - публичный сайт

## Файловая структура

```
lib/
  http.ts               # Основной HTTP клиент
  http.examples.ts      # Примеры использования
  README.md            # Документация модуля

types/
  api.ts               # Типы для API ошибок и запросов
```

## Совместимость

- ✅ Next.js 14 App Router
- ✅ TypeScript 5.9.3
- ✅ Server Components
- ✅ Client Components
- ✅ React Query готовность
- ✅ NextAuth v5 интеграция
