# M4 — Наполнение тестовыми данными (через админку) — подробное ТЗ

Цель: создать достаточный объём демонстрационного контента на 4 языках (en|es|fr|pt), чтобы публичный сайт и читалка (M5–M6) могли полноценно отображать страницы, книги, версии и таксономии. Наполнение выполняется через админку, чтобы проверить все рабочие флоу.

Зависимости: M0–M3 (каркас, auth/роли, слой данных, админка). Роли: `admin|content_manager`.

## Результат этапа

- Создано: 5–10 CMS‑страниц (per‑lang), 10–20 книг, для части книг — версии `text` и/или `audio` с главами.
- Настроены категории и теги (минимум 5 категорий, 10 тегов), привязки к книгам/версиям.
- Для ключевых сущностей заполнены SEO‑поля (title/description/canonical).
- Для каждой логической сущности есть матрица переводов на 2–4 языках; `availableLanguages` отражает реальность.

---

## Общие принципы

- Всё создаём из админки `/admin/:lang` (как в M3), язык контента задаёт сегмент URL.
- Slug уникален в рамках языка. Генерация из заголовка с ручной правкой.
- SEO минимум: `metaTitle` (≈50–60 символов), `metaDescription` (≈140–160 символов), корректный canonical по правилам (см. docs/frontend-agents/seo.md).
- Порядок глав — последовательные номера с шагом 1. Для аудио — корректные `audioUrl` (можно placeholder) и `duration?`.
- Стараться иметь хотя бы 2 языка для каждой сущности; если перевода нет — всё равно указывать доступные языки корректно.

---

## Задачи и ТЗ

### 1) План наполнения и инвентарь контента

ТЗ:

- Подготовить список сущностей к созданию:
  - CMS‑страницы: Home/О нас/Контакты/Политики (5–10), по всем 4 языкам.
  - Книги: 10–20 классических произведений в public domain; для 5–10 — добавить версии `text`, для 3–5 — `audio` (можно фейковые `audioUrl`).
  - Таксономии: 5+ категорий (жанры/эпохи), 10+ тегов.
- Создать шаблон инвентаря (таблица/CSV/MD) с колонками: `entity`, `groupId`, `lang`, `title`, `slug`, `status`, `hasText`, `hasAudio`, `categories`, `tags`, `seoTitle`, `seoDesc`, `notes`.
  Критерии приёмки:
- Файл инвентаря создан и согласован; объём покрывает требования результата.
  Артефакты:
- `docs/seed/content-inventory.md` (или `.csv`).

### 2) Страницы CMS (Pages)

ТЗ:

- Для каждого языка создать 5–10 страниц: `home`, `about`, `contact`, `privacy`, `terms`, и 1–2 контентные.
- Для каждой: `title`, `slug`, `content` (текст‑заглушка), `status=published`, SEO‑поля.
- Переводы: через «Создать перевод» в админке; проверить матрицу языков.
  Критерии приёмки:
- На всех 4 языках есть минимальный набор страниц; slug/SEO корректны.
  Артефакты:
- Заполненные записи Pages в БД (через админку).

### 3) Книги (Books) и переводы

ТЗ:

- Создать 10–20 книг на en (основной язык), затем переводы на es|fr|pt при наличии; минимум по 2 языка на книгу.
- Поля: `title`, `slug`, `description?`, `status`, SEO‑поля. Проверить уникальность slug в языке.
- Привязать категории/теги (из задачи 5).
  Критерии приёмки:
- Не менее 10 книг; у половины — переводы на 2–3 языка; корректные slug/SEO.
  Артефакты:
- Записи Books и их переводы.

### 4) Версии и главы (text/audio)

ТЗ:

- Для 5–10 книг создать версии `text` с 3–10 главами. `chapterNumber` — последовательный.
- Для 3–5 книг создать `audio` версии (можно одинаковые `audioUrl` на все главы как placeholder) с 3–10 аудиоглав.
- `isFree` — на часть версий поставить `true` (для публичных примеров); `status=published`.
  Критерии приёмки:
- У каждой выбранной книги версии и главы доступны; читалка в M6 сможет их отобразить.
  Артефакты:
- Записи Versions, Chapters, AudioChapters.

### 5) Категории и теги (таксономии)

ТЗ:

- Создать 5+ категорий и 10+ тегов на en, затем переводы (минимум на es|fr или pt).
- Привязать категории/теги к книгам/версиям через админку.
- Проверить списки `/admin/:lang/categories` и `/admin/:lang/tags` с фильтрами/поиском.
  Критерии приёмки:
- Таксономии существуют, переводы частично готовы; привязки работают.
  Артефакты:
- Записи Categories/Tags и связи.

### 6) SEO‑поля

ТЗ:

- Заполнить `metaTitle` и `metaDescription` для всех Pages и Books; для Versions — по возможности.
- Соблюдать длины; canonical по правилам: Book/Page с `/:lang`, Version без префикса.
- Проверить предпросмотр `SeoPreview` в админке.
  Критерии приёмки:
- SEO‑поля заполнены, предпросмотр без ошибок.
  Артефакты:
- Заполненные SEO поля.

### 7) Проверки качества данных

ТЗ:

- Пройти чек‑лист:
  - Уникальность slug внутри языка; нет пустых title.
  - Матрица переводов закрыта (где нужно) или осознанные «дыры» задокументированы.
  - Главы пронумерованы без пропусков; аудио ссылки валидны (пусть placeholder, но не 404).
  - `availableLanguages` на страницах списков/деталей отражает текущую картину.
  - Категории/теги связаны с книгами/версиями; списки по таксономиям не пустые.
  - Статусы публикации корректны и соответствуют ожиданиям (на публичке не появятся черновики).
- Зафиксировать найденные проблемы в `docs/seed/data-issues.md`.
  Критерии приёмки:
- Чек‑лист закрыт; известные «дыры» перечислены и приняты.
  Артефакты:
- `docs/seed/data-issues.md` (если есть замечания).

### 8) Производительность и лимиты

ТЗ:

- Создавать контент партиями (не более 10–15 записей подряд) с паузами, чтобы не словить 429.
- При 429 — повтор через 10–30 секунд; UI показывает дружелюбный месседж.
- Проверить пагинацию/фильтры в списках при большом числе записей.
  Критерии приёмки:
- Нет блокирующих 429; списки остаются отзывчивыми.
  Артефакты:
- —

### 9) Документация по наполнению

ТЗ:

- Описать короткие инструкции по созданию/переводу страниц/книг/версий в `docs/seed/how-to-admin.md` с иллюстрацией основных шагов и типичными ошибками (slug, SEO длины, индикаторы переводов).
  Критерии приёмки:
- Док доступен и понятен; контент‑менеджер может повторить.
  Артефакты:
- `docs/seed/how-to-admin.md`.

### 10) Верификация на публичке (smoke)

ТЗ:

- Открыть на публичке:
  - `/:lang/pages/[slug]` для 3–5 страниц каждого языка.
  - `/:lang/books/[slug]/overview` для 5–10 книг, проверить доступные языки и CTA к версиям.
  - `/(neutral)/versions/[id]` для нескольких версий; пролистать главы.
  - Таксономии: `/:lang/categories/[slug]/books`, `/:lang/tags/[slug]/books` — убедиться в непустых списках.
    Критерии приёмки:
- Публичные страницы отображают контент; переключатель языка корректно ведёт на переводы.
  Артефакты:
- —

---

## Схема каталогов (артефакты M4)

```
docs/
  seed/
    content-inventory.md   # таблица/список сущностей и переводов
    data-issues.md         # найденные проблемы (если есть)
    how-to-admin.md        # инструкция по наполнению
```

## Риски и примечания

- Отсутствие готовых переводов: допустимо закрыть 2 языка из 4 для части сущностей, но зафиксировать в инвентаре.
- Права и роли: убедиться, что операции выполняются под `admin|content_manager`.
- Медиа: загрузчик/хранилище вне MVP — используем placeholder URL’ы (согласовать формат).
- Соответствие лицензиям public domain/описаний: тексты‑заглушки — безопасные, без копирайта.

## Чек‑лист готовности M4

- [ ] content‑inventory.md заполнен (объём и языки)
- [ ] Созданы 5–10 Pages на каждый язык (минимум базовые)
- [ ] Созданы 10–20 Books, переводы минимум на 2 языка у половины
- [ ] Версии text/audio и главы добавлены по плану, статусы корректны
- [ ] Категории/теги заведены и привязаны
- [ ] SEO поля заполнены (title/description/canonical)
- [ ] Проверки качества пройдены; issues задокументированы
- [ ] Smoke‑проверка публички успешна
