# M0 — Bootstrap проекта (подробное ТЗ)

Цель: запустить каркас Next.js (App Router, TS) с Ant Design, React Query, NextAuth и i18n‑роутингом, добавить базовые layout’ы, заглушки страниц публички и админки, переключатели языка. Проект должен собираться без ошибок.

## Результат этапа

- Сборка/запуск без ошибок.
- Работают маршруты:
  - `/:lang` (en|es|fr|pt) — публичная зона с базовым layout.
  - `/admin/:lang` — админка с базовым layout и переключателем языка.
- Есть шапка/футер (простые заглушки), 404/ошибка, базовая тема AntD.
- Переключатели языка в публичке и админке корректно меняют URL, не ломая навигацию.

## Задачи и ТЗ

### 1) Инициализация проекта и инфраструктура

ТЗ:

- Инициализировать Next.js (App Router, TypeScript). Добавить ESLint/Prettier, настроить скрипты форматирования/линта.
- Подключить Ant Design (стили, провайдер темы), React Query, и заготовку под NextAuth (без реальной логики входа — это в M1).
- Добавить `.env.example` с ключами:
  - `NEXT_PUBLIC_API_BASE_URL=`
  - `NEXTAUTH_URL=`
  - `NEXTAUTH_SECRET=`
- Включить strict mode React, настроить `tsconfig.json` (strict, baseUrl, paths по необходимости).
  Критерии приёмки:
- `yarn build`/`yarn dev` — без ошибок; линтер и typecheck — зелёные.
  Артефакты:
- `package.json`, `tsconfig.json`, `.eslintrc`, `.prettierrc`, `.env.example`.

### 2) Структура каталогов и роутинг (App Router)

ТЗ:

- Создать сегменты:
  - `app/[lang]` с `lang` ограниченным до en|es|fr|pt (через generateStaticParams или runtime проверку).
  - `app/admin/[lang]` — админка.
  - `app/(neutral)` — нейтральные маршруты (на будущее: `/versions/[id]`).
- Добавить страницы‑заглушки: `app/[lang]/page.tsx`, `app/admin/[lang]/page.tsx`.
- Реализовать 404 и error boundary: `not-found.tsx`, `error.tsx` для публичной зоны; аналогично для админки при необходимости.
  Критерии приёмки:
- Навигация по ключевым путям возвращает страницу, 404 работает.
  Артефакты:
- Структура `app/…`, заглушки страниц и error‑страницы.

### 3) Базовые layout’ы и провайдеры

ТЗ:

- `app/[lang]/layout.tsx`: установить текущий язык из `params.lang`, отрендерить общий `Providers` с React Query, AntD ConfigProvider (тема), и базовую шапку/футер.
- `app/admin/[lang]/layout.tsx`: аналогично, но со своим AdminHeader с переключателем языка и местом под боковую навигацию.
- Вынести общий провайдер в `src/providers/AppProviders.tsx` (React Query, AntD, потенциально i18n контекст на будущее).
- Подключить базовые стили (normalize/AntD), CSS variables под тему.
  Критерии приёмки:
- Глобальные стили применяются, тема AntD работает, провайдеры доступны на страницах.
  Артефакты:
- `app/[lang]/layout.tsx`, `app/admin/[lang]/layout.tsx`, `src/providers/AppProviders.tsx`, `src/styles/globals.css`.

### 4) Переключатели языка (публичка и админка)

ТЗ:

- Публичка: `LanguageSwitcher` в шапке, меняет `/:lang` в текущем URL (с сохранением остальной части пути, если это возможно на данном этапе; при заглушках — редирект на корень выбранного языка).
- Админка: `AdminLanguageSwitcher` (см. roadmap) — пока без резолва конкретных сущностей; только смена `/admin/[lang]`.
- Утилиты для смены языка: `src/i18n/lang.ts` с `SUPPORTED_LANGS=['en','es','fr','pt']`, `isSupportedLang()`, `switchLangInPath(path, lang)`.
  Критерии приёмки:
- Выпадающий список языков работает в обеих зонах, URL корректно меняется.
  Артефакты:
- `src/components/LanguageSwitcher.tsx`, `src/components/admin/AdminLanguageSwitcher.tsx`, `src/i18n/lang.ts`.

### 5) Конфигурация NextAuth (заготовка)

ТЗ:

- Подготовить структуру для NextAuth: файл конфигурации, провайдер в App Router (session provider на клиенте при необходимости), но без реализаций провайдера Credentials (перенесём в M1).
- Определить типы Session/JWT на FE уровне (расширение интерфейсов), оставить TODO‑блоки.
  Критерии приёмки:
- Проект собирается с временной заглушкой NextAuth; легко расширить в M1 без рефакторинга.
  Артефакты:
- `src/auth/config.ts`, `src/types/auth.ts`, заготовка провайдера.

### 6) Базовый fetcher и конфиг окружения

ТЗ:

- Создать минимальный fetcher с базовым URL из env, без авторизации (Auth в M1), с обработкой ошибок `!ok` и парсингом JSON.
- Положить его в `src/lib/http.ts`; предусмотреть установку заголовка `Accept-Language` (значение берём из сегмента `[lang]`, прокидываем в серверных компонентов через headers()).
  Критерии приёмки:
- Проба 1–2 GET запросов к бэку (если доступен) или к локальной заглушке — проходит, ошибки маппятся.
  Артефакты:
- `src/lib/http.ts`.

### 7) Качество: линтеры, форматтеры, pre-commit

ТЗ:

- Настроить ESLint (React/TS/Next), Prettier; добавить `lint-staged` + `husky` (pre-commit) — опционально в M0, можно перенести в M2.
- Добавить npm‑скрипты: `dev`, `build`, `start`, `lint`, `typecheck`, `format`.
  Критерии приёмки:
- `yarn lint` и `yarn typecheck` проходят; pre-commit работает (если включили).

## Риски и примечания

- Сегмент `[lang]` должен валидироваться (неизвестный язык → редирект/404).
- Переключатели языка не должны терять важные query‑параметры (в будущем для админской фильтрации).
- NextAuth заготовка не должна ломать SSR/SSG (минимум клиентской логики сейчас).

## Чек‑лист готовности M0

- [ ] Стартовый проект на Next.js + TS собран
- [ ] App Router сегменты `[lang]` и `admin/[lang]`
- [ ] Базовые layout’ы + шапка/футер + стили AntD
- [ ] Переключатели языка (публичка/админка)
- [ ] Заготовка NextAuth
- [ ] Минимальный fetcher и `.env.example`
- [ ] Линтер/тайпчек зелёные
