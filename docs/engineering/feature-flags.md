# Feature flags — подход

Цель: безопасные выкаты и поэтапное включение функционала.

## Виды флагов

- Build‑time (compile‑time): через переменные окружения на этапе сборки; меняют бандл. Пример: `process.env.NEXT_PUBLIC_FEATURE_X === '1'`.
- Runtime (server/client): читаются в рантайме (SSR/route handlers) из серверных env или конфигурации, клиенту передаются как часть стейта страницы (без секретов).

## Рекомендации

- Для FE: предпочтительно runtime флаги, чтобы не пересобирать ради выката. Серверные флаги не раскрывать на клиент, если не требуется.
- Единый модуль `src/flags.ts` с типами и чтением источников.
- В SSR `generateMetadata`, layouts и критических ветках — учитывать флаги.
- Тестирование: unit для ветвлений, e2e смоук при включённых/выключенных флагах.

## Источники

- ENV (NEXT*PUBLIC*\* для клиентских)
- Бэкенд конфиг (endpoint /features) — кэшировать и прокидывать в страницу

## Пример API контракта (идея)

`GET /features` → `{ readerNewUI: true, seoV2: false }`

## Процедура

1. Добавить флаг и дефолтное значение
2. Прокрыть тестами обе ветки
3. Включать поэтапно: dev → stage → prod
4. Через 1–2 релиза — удалить мёртвый код
